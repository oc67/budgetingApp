
{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}

<style>

.line-form {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.line-form > input,
.line-form > textarea {
    flex: 1;  /* make all children share space */
    margin: 0 !important;
}

.line-form .form-check {
    flex: 0;
    margin-left: auto !important;
}

</style>


<!--Displays the detail of the clicked article -->
<div class="budget-entry">
    
<h2><b><u>New budget</u></b></h2>
</div>

<hr>

<!--Displays all the comments -->
<h4> Budget header</h4>


<form action="" method="post">{% csrf_token %}
    {{ form|crispy }}
    {{ formset.management_form }}



<br><br>

<h4> Budget lines</h4>
  <div id="formset-container">
    <!--Displays insight lines of budget-->
    {% for form in formset %}
      <br><br>

      <div class="line-form">
            {{ form.id }}
            {{ form|crispy }}
            {{form.DELETE|crispy}}

            </div>
        Total price of line: Â£ {{price}}
    <br><br>
    {% endfor %}



   </div>
    <button type="button" id="add-line">Add Line</button>
    <br><br>
    <button class="btn btn-success ml-2" type="submit">Update </button>
</form>

<!--Javascript code required to enable users to add multiple budget lines -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
  document.getElementById('add-line').addEventListener('click', function() {
    const container = document.getElementById('formset-container');
    const totalForms = document.querySelector('input[name="{{ formset.prefix }}-TOTAL_FORMS"]');
    const currentFormCount = parseInt(totalForms.value);

    // Clone the empty form template (you need to prepare this!)
    const emptyFormTemplate = document.getElementById('empty-form-template').innerHTML;

    // Replace __prefix__ with currentFormCount in the cloned HTML
    const newFormHtml = emptyFormTemplate.replace(/__prefix__/g, currentFormCount);

    // Insert new form HTML into container
    const div = document.createElement('div');
    div.classList.add('line-form');
    div.innerHTML = newFormHtml;
    container.appendChild(div);

    // Increment TOTAL_FORMS count
    totalForms.value = currentFormCount + 1;
    });
});
</script>

<!-- Hidden empty form template -->
<div id="empty-form-template" style="display:none;">
  {{ formset.empty_form|crispy }}
</div>

    <p>Back to <a href="{% url 'budget_list' %}">All budgets</a>.</p>

{% endblock content %}